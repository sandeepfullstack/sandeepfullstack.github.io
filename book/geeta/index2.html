<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bhagavad Gita Verses</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f4f4f9;
            color: #333;
        }
        h1 {
            background: #4CAF50;
            color: white;
            padding: 20px;
            margin: 0;
            text-align: center;
        }
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 20px auto;
        }
        .filter {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        select, button {
            padding: 10px;
            font-size: 16px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .verse {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .verse h2 {
            margin-top: 0;
            font-size: 1.2em;
        }
        .verse p {
            line-height: 1.6;
        }
        audio {
            margin-top: 10px;
            width: 100%;
            max-width: 600px;
        }
        @media (max-width: 768px) {
            .filter {
                flex-direction: column;
                align-items: flex-start;
            }
            select, button {
                width: 100%;
                box-sizing: border-box;
            }
        }
    </style>
</head>
<body>
    <h1>Shree Bhagavad Gita</br>(Priyanshu Panghal)</h1>
    <div class="container">
        <div class="filter">
            <label for="chapterFilter">Filter by Chapter:</label>
            <select id="chapterFilter">
                <option value="all">All Chapters</option>
                <!-- Chapter options will be populated here -->
            </select>
            <button onclick="filterVerses()">Apply Filter</button>
        </div>
        <div id="versesContainer">
            <!-- Verses will be populated here -->
        </div>
    </div>
    <script src="./verse.js"></script>
    <script src="./translation.js"></script>
    <script>
        function filterTranslation(verseId, language='hindi') {
            if(language==''){
                return translation.filter(item => item.verse_id === verseId);
            }else{
                return translation.filter(item => item.verse_id === verseId && item.lang === language);
            }  
        }

        function populateChapterFilter() {
            const chapterFilter = document.getElementById('chapterFilter');
            const chapters = [...new Set(verses.map(v => v.chapter_number))];
            chapters.forEach(chapter => {
                const option = document.createElement('option');
                option.value = chapter;
                option.textContent = `Chapter ${chapter}`;
                chapterFilter.appendChild(option);
            });
        }

        async function displayVerses(filteredVerses) {
            const versesContainer = document.getElementById('versesContainer');
            versesContainer.innerHTML = ''; // Clear previous content
            for (const verse of filteredVerses) {
                const trans = await filterTranslation(verse.id, '');
                const verseDiv = document.createElement('div');
                verseDiv.className = 'verse';
                const audio = `<audio controls><source src="./audio/${verse.chapter_number}/${verse.verse_number}.mp3" type="audio/mpeg">Your browser does not support the audio element.</audio>`;
                const vrs = `
                    <h2>${verse.chapter_number}:${verse.verse_number} ${verse.title}</h2>
                    ${audio}
                    <p><strong>Slok:</strong> ${verse.text}</p>
                    <p><strong>Transliteration:</strong> ${verse.transliteration}</p>
                    <p><strong>Meaning:</strong> ${verse.word_meanings}</p>
                `;
                let tranHtml = '<p>';
                for (const tran of trans) {
                    tranHtml += `<strong>Author Name:</strong> ${tran?.authorName} </br>`;
                    tranHtml += `<strong>Description:</strong> ${tran?.description} </br>`;
                }
                tranHtml += '</p>';
                verseDiv.innerHTML = vrs + tranHtml;
                versesContainer.appendChild(verseDiv);
            }
        }

        function filterVerses() {
            const chapterFilter = document.getElementById('chapterFilter');
            const selectedChapter = chapterFilter.value;
            const filteredVerses = selectedChapter === 'all'
                ? verses
                : verses.filter(v => v.chapter_number == selectedChapter);
            displayVerses(filteredVerses);
        }

        // Initial setup
        populateChapterFilter();
        filterVerses(); // Display all verses initially
    </script>
</body>
</html>
