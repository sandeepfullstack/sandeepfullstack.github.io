<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bhagavad Gita Verses</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f4f4f9;
            color: #333;
            width: 100%;
            max-width: 100%;
        }
        h1 {
            background: #4CAF50;
            color: white;
            padding: 20px;
            /* margin: 0; */
            text-align: center;
            font-size: 2em;            
        }
        .container {
            /* width: 90%; */
            width: 100%;
            float: left;
            /* max-width: 1200px; */
            /* margin: 20px auto; */
        }
        .filter {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }
        select, button {
            padding: 10px;
            font-size: 1em;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .verse {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .verse h2 {
            margin-top: 0;
            font-size: 1.5em;
        }
        .verse p {
            line-height: 1.6;
        }
        audio {
            margin-top: 10px;
            width: 100%;
            max-width: 100%;
        }
        .green, .blue, .red {
            width: 100%;
            float: left;
            text-align: center;
        }
        .green {
            color: #4CAF50;            
        }
        .blue {
            color: hsl(197, 56%, 32%);        
        }
        .red {
            color: #af814c;    
        }
        @media (max-width: 768px) {
            .filter {
                flex-direction: column;
                align-items: stretch;
            }
            select, button {
                width: 100%;
                box-sizing: border-box;
            }
            /* #goToTopBtn {
                width: 7%;
            } */
        }
        @media (max-width: 480px) {
            h1 {
                font-size: 1.5em;
            }
            .verse h2 {
                font-size: 1.2em;
            }
            select, button {
                padding: 8px;
                font-size: 0.9em;
            }
        }
        /* #goToTopBtn {
            display: none; 
            position: fixed;
            bottom: 20px;            
            right: 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            padding: 10px;
            cursor: pointer;
            font-size: 1em;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        #goToTopBtn:hover {
            background-color: #45a049;
        }
        @media (max-width: 768px) {
            #goToTopBtn {
                padding: 8px;
                font-size: 0.9em;
                right: 10px;
                bottom: 10px;
            }
        }
        @media (max-width: 480px) {
            #goToTopBtn {
                padding: 6px;
                font-size: 0.8em;
                right: 10px;
                bottom: 10px;
            }
        } */
    </style>
</head>
<body>    
    <div class="container">
        <h1>Shree Bhagavad Gita</br>(Priyanshu Panghal)</h1>
        <div class="filter">
            <label for="chapterFilter">Filter by Chapter:</label>
            <select id="chapterFilter">
                <option value="all">All Chapters</option>
                <!-- Chapter options will be populated here -->
            </select>
            <button onclick="filterVerses()">Apply Filter</button>
        </div>
        <div id="versesContainer">
            <!-- Verses will be populated here -->
        </div>
        <!-- <button id="goToTopBtn" title="Go to Top">Top</button> -->
    </div>    
    <script src="./verse.js"></script>
    <script src="./translation.js"></script>
    <script src="./commentary.js"></script>
    <script>
        function filterTranslation(verseId, language='hindi') {
            if(language==''){
                return translation.filter(item => item.verse_id === verseId);
            }else{
                return translation.filter(item => item.verse_id === verseId && item.lang === language);
            }  
        }

        function filterCommentary(verseId, language='hindi') {
            if(language==''){
                return commentary.filter(item => item.verse_id === verseId);
            }else{
                return commentary.filter(item => item.verse_id === verseId && item.lang === language);
            }  
        }

        function populateChapterFilter() {
            const chapterFilter = document.getElementById('chapterFilter');
            const chapters = [...new Set(verses.map(v => v.chapter_number))];
            chapters.forEach(chapter => {
                const option = document.createElement('option');
                option.value = chapter;
                option.textContent = `Chapter ${chapter}`;
                chapterFilter.appendChild(option);
            });
        }

        async function displayVerses(filteredVerses) {
            const versesContainer = document.getElementById('versesContainer');
            versesContainer.innerHTML = ''; // Clear previous content
            for (const verse of filteredVerses) {
                let trans1=[];
                 trans1 = await filterTranslation(verse.id, '');
                let cmtries = [];
                // cmtries = await filterCommentary(verse.id, '');
                const trans=[...trans1,...cmtries];
                
                const verseDiv = document.createElement('div');
                verseDiv.className = 'verse';
                const audio = `<audio controls><source src="./audio/${verse.chapter_number}/${verse.verse_number}.mp3" type="audio/mpeg">Your browser does not support the audio element.</audio>`;
                const vrs = `
                    <h2>${verse.chapter_number}:${verse.verse_number} ${verse.title}</h2>
                    ${audio}
                    <p><strong>Sloka:</strong> ${verse.text}</p>
                    <p><strong>Transliteration:</strong> ${verse.transliteration}</p>
                    <p><strong>Meaning:</strong> ${verse.word_meanings}</p>
                `;
                let tranHtml = `</br>
                <p style="color: #333;border: 2px solid #8B4513;padding: 10px;border-radius: 20px;margin: 10px 0;background-color: #f9f9f9;">`;
                    let hinDesc='';
                    let engDesc='';
                    let sanDesc='';
                for (const tran of trans) {
                    if(tran.lang =='hindi'){                        
                       hinDesc += `<strong>Author Name:</strong> ${tran?.authorName} </br>`;
                       hinDesc += `<strong>Description:</strong> ${tran?.description} </br>`;
                   }
                    if(tran.lang =='english'){                        
                        engDesc += `<strong>Author Name:</strong> ${tran?.authorName} </br>`;
                        engDesc += `<strong>Description:</strong> ${tran?.description} </br>`;
                    }
                    if(tran.lang =='sanskrit'){
                        sanDesc += `<strong>Author Name:</strong> ${tran?.authorName} </br>`;
                        sanDesc += `<strong>Description:</strong> ${tran?.description} </br>`;
                    }
                }
                if(!!hinDesc){
                    tranHtml +='<strong class="green"><========> Hindi <========></strong> </br>'+hinDesc;
                }
                if(!!engDesc){
                    tranHtml +='<strong class="blue"><========> English <========></strong> </br>'+engDesc;
                }
                if(!!sanDesc){
                    tranHtml +='<strong class="red"><========> Sanskrit <========></strong> </br>'+sanDesc;
                }
                tranHtml += '</p>';
                verseDiv.innerHTML = vrs + tranHtml;
                versesContainer.appendChild(verseDiv);
            }
        }

        function filterVerses() {
            const chapterFilter = document.getElementById('chapterFilter');
            const selectedChapter = chapterFilter.value;
            const filteredVerses = selectedChapter === 'all'
                ? verses
                : verses.filter(v => v.chapter_number == selectedChapter);
            displayVerses(filteredVerses);
        }

        // Initial setup
        populateChapterFilter();
        filterVerses(); // Display all verses initially

        // Get the button
        /* const goToTopBtn = document.getElementById('goToTopBtn');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) { 
                goToTopBtn.style.display = 'block';
            } else {
                goToTopBtn.style.display = 'none';
            }
        });

        goToTopBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }); */

    </script>
</body>
</html>
